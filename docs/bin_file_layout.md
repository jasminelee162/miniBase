# MiniBase 数据库磁盘文件（.bin）结构说明

本文件说明 MiniBase 数据库的 `.bin` 文件（单文件表空间）在磁盘上的布局、各页的作用，以及表结构元数据的存储方式。

---

## 文件整体布局

- 所有数据、元数据、索引等都存储在一个 `.bin` 文件中。
- 文件空间在创建时按 `DEFAULT_DISK_SIZE_BYTES` 预分配（详见 `util/config.h`）。

---

## 页类型与分布

### 1. 第 0 页：元数据页（Meta Superblock）

- 作用：保存数据库文件的基础元信息。
- 内容包括：
  - **魔数** `"M_BDiniM"`：用于标识文件类型和合法性。
  - **版本号**：数据库文件格式版本。
  - **页大小**：如 4096 字节。
  - **next_page_id**：下一个可分配页号。
  - **catalog_root**：目录页（Catalog Page）的页号入口。
  - 其他元数据字段。
- `page_type` 通常为 `METADATA_PAGE`。

### 2. 目录页（Catalog Page）

- 由第 0 页的 `catalog_root` 字段指向。
- 作用：保存所有表的元数据（表名、字段名、字段类型等）。
- 本质上也是一个普通页，只是 `page_type` 为 `CATALOG_PAGE`。
- 典型结构体如 `TableMeta` 可序列化到目录页中，描述表结构。

### 3. 数据页（Data Page）

- 从第 1 页开始，或由目录页分配。
- 作用：保存表的实际数据行。
- `page_type` 为 `DATA_PAGE`。
- 只存储数据，不保存表结构信息。

### 4. 索引页（Index Page）

- 用于存储索引结构（如 B+树节点）。
- `page_type` 为 `INDEX_PAGE`。

---

## 典型访问流程

1. **启动时**，读取第 0 页，校验魔数，获取 `catalog_root`。
2. **读取表结构**，通过 `catalog_root` 定位目录页，解析表名、字段名、类型等元数据。
3. **访问数据**，根据目录页信息定位数据页，读取或写入实际数据行。
4. **索引操作**，通过索引页加速数据检索。

---

## 设计总结

- **第 0 页**：保存文件元数据和入口信息（如 `catalog_root`）。
- **目录页**：保存所有表的结构元数据，由第 0 页指向。
- **数据页**：保存表的实际数据行。
- **索引页**：保存索引结构。
- 页类型通过 `page_type` 字段区分，便于扩展和管理。

---

> 本设计保证了数据库文件结构清晰、可扩展，便于后续实现表管理、索引、事务等高级
# MiniBase 测试脚本执行指南

## 概述
本指南提供了四个全面测试脚本的执行顺序和说明，确保对MiniBase数据库系统的所有功能进行全面测试。

## 测试脚本列表

### 1. 基础功能测试 (`test_comprehensive_basic.sql`)
- **目的**: 测试所有支持的SQL语句类型
- **覆盖范围**: 基础CRUD、高级查询、存储过程、约束支持
- **执行用户**: root账号

### 2. 权限系统测试 (`test_permissions.sql`)
- **目的**: 测试DBA、DEVELOPER、ANALYST三种角色的权限控制
- **覆盖范围**: 用户权限、表级权限、跨用户操作
- **执行用户**: 多个用户角色

### 3. 导入导出测试 (`test_import_export.sql`)
- **目的**: 测试.dump和.import命令的各种场景
- **覆盖范围**: 单表、多表、复杂结构、大数据量
- **执行模式**: 需要--exec参数

### 4. 错误处理测试 (`test_error_handling.sql`)
- **目的**: 测试各种错误情况的处理机制
- **覆盖范围**: 语法错误、语义错误、约束错误
- **执行用户**: root账号

## 执行方式

### 方式1：一键执行所有测试（推荐）
```bash
# Windows
cd tests/sql
run_all_tests.bat

# Linux/macOS
cd tests/sql
chmod +x run_all_tests.sh
./run_all_tests.sh
```

### 方式2：手动逐步执行

#### 步骤1: 准备环境
```bash
# 确保数据库目录存在
mkdir -p data

# 清理可能存在的测试表（如果存在）
# 注意：系统不支持DROP TABLE IF EXISTS，需要手动检查
# 可以先运行一次测试脚本，如果有表已存在错误，再手动删除
```

#### 步骤2: 执行基础功能测试
```bash
# 使用带自动登录的脚本（推荐）
.\build\src\cli\Debug\minidb_cli.exe --exec --db data/test_comprehensive.db < tests/sql/test_comprehensive_basic_with_login.sql
```
**预期结果**: 所有基础功能测试通过，包括CRUD、高级查询、存储过程、约束等

#### 步骤3: 执行权限系统测试
```bash
# 使用带自动登录的权限测试脚本
.\build\src\cli\Debug\minidb_cli.exe --exec --db data/test_comprehensive.db < tests/sql/test_permissions_with_login.sql
```
**预期结果**: 权限控制正确实施，不同角色权限限制有效

#### 步骤4: 执行导入导出测试
```bash
# 使用带自动登录的导入导出测试脚本
.\build\src\cli\Debug\minidb_cli.exe --exec --db data/test_comprehensive.db < tests/sql/test_import_export_with_login.sql
```
**预期结果**: 导入导出功能正常，数据完整性得到保证

#### 步骤5: 执行错误处理测试
```bash
# 使用带自动登录的错误处理测试脚本
.\build\src\cli\Debug\minidb_cli.exe --exec --db data/test_comprehensive.db < tests/sql/test_error_handling_with_login.sql
```
**预期结果**: 各种错误情况得到正确处理，错误信息清晰准确

## 详细执行说明

### 基础功能测试执行要点
1. **清理环境**: 脚本会自动清理可能存在的测试表
2. **分块执行**: 每个功能区块都有明确的预期结果
3. **验证结果**: 每个测试后都有验证查询
4. **约束测试**: 特别注意约束违反的错误处理

### 权限测试执行要点
1. **用户创建**: 需要先创建测试用户
2. **角色切换**: 按脚本中的提示切换不同用户角色
3. **权限验证**: 观察权限拒绝和允许的情况
4. **数据隔离**: 验证不同用户的数据访问权限

### 导入导出测试执行要点
1. **执行模式**: 必须使用--exec参数启动CLI
2. **文件路径**: 确保导出路径存在且有写权限
3. **数据验证**: 导入后验证数据完整性
4. **约束保持**: 验证约束在导入后仍然有效

### 错误处理测试执行要点
1. **错误观察**: 仔细观察错误信息和提示
2. **系统稳定性**: 验证错误后系统状态稳定
3. **错误恢复**: 测试错误后的正常操作
4. **信息质量**: 评估错误信息的准确性和有用性

## 预期测试结果

### 成功标准
- ✅ 所有基础SQL功能正常工作
- ✅ 权限系统正确实施访问控制
- ✅ 导入导出功能完整可靠
- ✅ 错误处理机制有效且用户友好
- ✅ 数据完整性和一致性得到保证
- ✅ 系统在错误情况下保持稳定

### 失败情况处理
- ❌ 如果某个测试失败，记录具体错误信息
- ❌ 检查系统日志文件获取详细错误信息
- ❌ 验证数据库文件完整性
- ❌ 必要时重新初始化测试环境

## 测试环境要求

### 系统要求
- Windows 10/11 或 Linux
- 足够的磁盘空间（至少100MB）
- 读写权限到测试目录

### 软件要求
- 编译好的MiniBase CLI
- 执行模式支持（--exec参数）
- 完整的权限系统支持

## 故障排除

### 常见问题
1. **权限错误**: 确保使用正确的用户角色执行测试
2. **文件路径错误**: 检查导出路径是否存在
3. **语法错误**: 验证SQL语句的正确性
4. **约束冲突**: 检查测试数据的唯一性
5. **表已存在错误**: 如果遇到"表已存在"错误，请先手动删除：`DROP TABLE table_name`

### 调试建议
1. 查看日志文件：`logs/cli_debug.log`
2. 使用调试命令：`.debug_fullscan <table>`
3. 检查数据库文件完整性
4. 重新编译和部署系统

## 测试报告模板

### 测试结果记录
```
测试日期: ___________
测试人员: ___________
系统版本: ___________

基础功能测试: [ ] 通过 [ ] 失败
权限系统测试: [ ] 通过 [ ] 失败  
导入导出测试: [ ] 通过 [ ] 失败
错误处理测试: [ ] 通过 [ ] 失败

总体评估: [ ] 优秀 [ ] 良好 [ ] 需要改进 [ ] 不合格

问题记录:
1. ________________
2. ________________
3. ________________

改进建议:
1. ________________
2. ________________
3. ________________
```

## 注意事项

1. **数据安全**: 测试脚本会创建和删除表，请确保在测试环境中执行
2. **执行顺序**: 严格按照建议顺序执行，确保测试的完整性
3. **错误记录**: 详细记录所有错误和异常情况
4. **环境隔离**: 使用独立的数据库文件进行测试
5. **备份重要**: 测试前备份重要的数据库文件
6. **DROP TABLE限制**: 系统不支持`DROP TABLE IF EXISTS`，如果表已存在需要先手动删除

## 联系支持

如果在测试过程中遇到问题，请：
1. 检查本文档的故障排除部分
2. 查看系统日志文件
3. 记录详细的错误信息
4. 联系开发团队获取支持
